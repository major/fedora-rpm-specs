# Generated by go2rpm 1.17.1
%bcond check 1
%bcond bootstrap 0

%global debug_package %{nil}
%if %{with bootstrap}
%global __requires_exclude %{?__requires_exclude:%{__requires_exclude}|}^golang\\(.*\\)$
%endif

%if 0%{?fedora} || 0%{?rhel} >= 10
%bcond system_foot 1
%else
# foot depends on wayland-protocol >= 1.32
# EL9 has only 1.31
%bcond system_foot 0
%endif

# https://github.com/gdamore/tcell
%global goipath         github.com/gdamore/tcell/v2
Version:                2.13.1

%gometa

%global common_description %{expand:
Tcell is an alternate terminal package, similar in some ways to termbox, but
better in others.}

%global golicenses      LICENSE
%global godocs          CHANGESv2.md AUTHORS TUTORIAL.md README.md
%global gosupfiles      webfiles/*

Name:           golang-github-gdamore-tcell-2
Release:        %autorelease
Summary:        Alternate terminal package

License:        Apache-2.0
URL:            %{gourl}
Source:         %{gosource}

# These are all needed for rebuilding the terminfo database.
%if %{without bootstrap}
%if %{with system_foot}
BuildRequires:  foot-terminfo
%endif
BuildRequires:  kitty-terminfo
BuildRequires:  ncurses
BuildRequires:  ncurses-base
BuildRequires:  ncurses-term
BuildRequires:  rxvt-unicode
%endif


%description %{common_description}

%gopkg

%prep
%goprep -A
%autopatch -p1 -q

%if %{without bootstrap}
ls -R terminfo/?/ > terminfo-files
# Use existing sources for:
# * sun, which is hand-coded, not generated
# * xterm-direct, which is hand-coded, not generated
# * ghostty is not yet packaged
skipped=(
    \! -path '*sun/term.go'
)
skipped+=(
    -a \! -path '*xterm/direct.go'
)
skipped+=(
    -a \! -path '*xterm_ghostty/term.go'
)
%if %{without system_foot}
# also use existing source for foot
skipped+=(
    -a \! -path '*foot/foot.go'
)
%endif
find terminfo/?/ "${skipped[@]}" -a -type f -delete
sed -i 's/go run mkinfo.go/$1/g' terminfo/gen.sh
sed -i 's/^alacritty$/alacritty,alacritty-direct|alacritty/g' terminfo/models.txt
%if %{with system_foot}
echo foot >> terminfo/models.txt
%endif
%endif

%if %{without bootstrap}
%generate_buildrequires
%go_generate_buildrequires
%endif

%if %{without bootstrap}
%build
# Rebuild database from source.
%gobuild -o %{gobuilddir}/bin/mkinfo terminfo/mkinfo.go
pushd terminfo
bash -x gen.sh %{gobuilddir}/bin/mkinfo
popd
ls -R terminfo/?/ > generated-terminfo-files
diff -u terminfo-files generated-terminfo-files || true
%endif

%install
%gopkginstall

%if %{without bootstrap}
%if %{with check}
%check
%gocheck
%endif
%endif

%gopkgfiles

%changelog
%autochangelog
