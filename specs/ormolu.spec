# generated by cabal-rpm-2.3.3 --bundle
# https://docs.fedoraproject.org/en-US/packaging-guidelines/Haskell/

%global choice choice-0.2.4.2
%global thenv th-env-0.1.1
# this overrides the fedora package
%global ghclibparser ghc-lib-parser-9.10.3.20250912

%global subpkgs %{choice} %{thenv} %{ghclibparser}

Name:           ormolu
Version:        0.7.7.0
Release:        12%{?dist}
Summary:        A formatter for Haskell source code

# markdown-unlit is MIT
License:        BSD-3-Clause AND MIT
URL:            https://hackage.haskell.org/package/ormolu
# Begin cabal-rpm sources:
Source0:        https://hackage.haskell.org/package/%{name}-%{version}/%{name}-%{version}.tar.gz
Source1:        https://hackage.haskell.org/package/%{choice}/%{choice}.tar.gz
Source2:        https://hackage.haskell.org/package/%{ghclibparser}/%{ghclibparser}.tar.gz
Source3:        https://hackage.haskell.org/package/%{thenv}/%{thenv}.tar.gz
Source4:        https://hackage.haskell.org/package/%{name}-%{version}/%{name}.cabal#/%{name}-%{version}.cabal
# End cabal-rpm sources

# Begin cabal-rpm deps:
BuildRequires:  dos2unix
BuildRequires:  ghc-rpm-macros-extra
BuildRequires:  ghc-Cabal-devel
BuildRequires:  ghc-Cabal-syntax-devel
BuildRequires:  ghc-Diff-devel
BuildRequires:  ghc-MemoTrie-devel
BuildRequires:  ghc-ansi-terminal-devel
BuildRequires:  ghc-array-devel
BuildRequires:  ghc-base-devel
BuildRequires:  ghc-binary-devel
BuildRequires:  ghc-bytestring-devel
#BuildRequires:  ghc-choice-devel
BuildRequires:  ghc-containers-devel
BuildRequires:  ghc-deepseq-devel
BuildRequires:  ghc-directory-devel
BuildRequires:  ghc-file-embed-devel
BuildRequires:  ghc-filepath-devel
#BuildRequires:  ghc-ghc-lib-parser-devel
BuildRequires:  ghc-megaparsec-devel
BuildRequires:  ghc-mtl-devel
BuildRequires:  ghc-optparse-applicative-devel
BuildRequires:  ghc-syb-devel
BuildRequires:  ghc-text-devel
#BuildRequires:  ghc-th-env-devel
BuildRequires:  help2man
# for missing dep 'th-env':
BuildRequires:  ghc-template-haskell-devel
BuildRequires:  ghc-th-compat-devel
# End cabal-rpm deps
# deps for 'ghc-lib-parsers':
BuildRequires:  alex
BuildRequires:  happy

%description
Ormolu is a formatter for Haskell source code.
The project was created with the following goals in mind:

- Using GHC's own parser to avoid parsing problems caused by haskell-src-exts.

- Let some whitespace be programmable. The layout of the input
  influences the layout choices in the output. This means that the
  choices between single-line/multi-line layouts in each particular
  situation are made by the user, not by an algorithm. This makes the
  implementation simpler and leaves some control to the user while
  still guaranteeing that the formatted code is stylistically
  consistent.

- Writing code in such a way so it's easy to modify and maintain.

- Implementing one “true” formatting style which admits no configuration.

- That formatting style aims to result in minimal diffs while still
  remaining very close to “conventional” Haskell formatting people
  use.

- Choose a style compatible with modern dialects of Haskell. As new
  Haskell extensions enter broad use, we may change the style to
  accommodate them.

- Idempotence: formatting already formatted code doesn't change it.

- Be well-tested and robust to the point that it can be used in large
  projects without exposing unfortunate, disappointing bugs here and
  there.


%prep
# Begin cabal-rpm setup:
%setup -q -a1 -a2 -a3
dos2unix -k -n %{SOURCE4} %{name}.cabal
# End cabal-rpm setup


%build
# Begin cabal-rpm build:
%ghc_libs_build -P -H %{subpkgs}
%ghc_bin_build
# End cabal-rpm build


%install
# Begin cabal-rpm install
%ghc_bin_install

set noclobber
mkdir -p %{buildroot}%{bash_completions_dir}
mkdir -p %{buildroot}%{fish_completions_dir}
mkdir -p %{buildroot}%{zsh_completions_dir}
%{buildroot}%{_bindir}/%{name} --bash-completion-script %{name} | sed s/filenames/default/ > %{buildroot}%{bash_completions_dir}/%{name}
%{buildroot}%{_bindir}/%{name} --fish-completion-script %{name} > %{buildroot}%{fish_completions_dir}/%{name}
%{buildroot}%{_bindir}/%{name} --zsh-completion-script %{name} | sed s/filenames/default/ > %{buildroot}%{zsh_completions_dir}/_%{name}

mkdir -p %{buildroot}%{_mandir}/man1/
help2man --no-info %{buildroot}%{_bindir}/%{name} > %{buildroot}%{_mandir}/man1/%{name}.1
# End cabal-rpm install

rm -r %{buildroot}%{ghclibdir}/lib

mkdir -p licenses/{ghc-lib-parsers,th-env}
cp -p %{ghclibparser}/LICENSE licenses/ghc-lib-parsers
cp -p %{thenv}/LICENSE licenses/th-env


%files
# Begin cabal-rpm files:
%license LICENSE.md licenses/{ghc-lib-parser,th-env}
%doc CHANGELOG.md CONTRIBUTING.md README.md
%{_bindir}/%{name}
%{bash_completions_dir}/%{name}
%{fish_completions_dir}/%{name}
%{zsh_completions_dir}/_%{name}
%{_mandir}/man1/%{name}.1*
# End cabal-rpm files


%changelog
* Fri Feb 27 2026 Jens Petersen <petersen@redhat.com> - 0.7.7.0-12
- convert to cabal-rpm --bundle
- drop markdown-unlit dep (only needed for th-env testsuite)
- update to choice-0.2.4.2

* Sun Feb 01 2026 Jens Petersen <petersen@redhat.com> - 0.7.7.0-11
- build with bundled ghc-lib-parser-9.10.3
- no longer ship subpackage libraries

* Wed Jan 28 2026 Jens Petersen <petersen@redhat.com> - 0.7.7.0-10
- https://hackage.haskell.org/package/ormolu-0.7.7.0/changelog
- add choice dep

* Fri Jan 16 2026 Fedora Release Engineering <releng@fedoraproject.org> - 0.7.4.0-9
- Rebuilt for https://fedoraproject.org/wiki/Fedora_44_Mass_Rebuild

* Thu Jul 24 2025 Fedora Release Engineering <releng@fedoraproject.org> - 0.7.4.0-8
- Rebuilt for https://fedoraproject.org/wiki/Fedora_43_Mass_Rebuild

* Tue Mar 25 2025 Jens Petersen <petersen@redhat.com> - 0.7.4.0-7
- https://hackage.haskell.org/package/ormolu-0.7.4.0/changelog

* Fri Jan 17 2025 Fedora Release Engineering <releng@fedoraproject.org> - 0.7.2.0-6
- Rebuilt for https://fedoraproject.org/wiki/Fedora_42_Mass_Rebuild

* Sun Jul 21 2024 Jens Petersen <petersen@redhat.com> - 0.7.2.0-5
- https://hackage.haskell.org/package/ormolu-0.7.2.0/changelog
- markdown-unlit-0.6.0

* Thu Jul 18 2024 Fedora Release Engineering <releng@fedoraproject.org> - 0.5.3.0-4
- Rebuilt for https://fedoraproject.org/wiki/Fedora_41_Mass_Rebuild

* Thu Jan 25 2024 Fedora Release Engineering <releng@fedoraproject.org> - 0.5.3.0-3
- Rebuilt for https://fedoraproject.org/wiki/Fedora_40_Mass_Rebuild

* Sun Jan 21 2024 Fedora Release Engineering <releng@fedoraproject.org> - 0.5.3.0-2
- Rebuilt for https://fedoraproject.org/wiki/Fedora_40_Mass_Rebuild

* Mon Jul 24 2023 Jens Petersen <petersen@redhat.com> - 0.5.3.0-1
- https://hackage.haskell.org/package/ormolu-0.5.3.0/changelog
- subpackage th-env

* Thu Jul 20 2023 Fedora Release Engineering <releng@fedoraproject.org> - 0.5.0.1-3
- Rebuilt for https://fedoraproject.org/wiki/Fedora_39_Mass_Rebuild

* Sun Jan 22 2023 Jens Petersen <petersen@redhat.com> - 0.5.0.1-1
- https://hackage.haskell.org/package/ormolu-0.5.0.1/changelog
- refresh to cabal-rpm-2.1.0 with SPDX migration

* Fri Jul 22 2022 Fedora Release Engineering <releng@fedoraproject.org> - 0.1.4.1-5
- Rebuilt for https://fedoraproject.org/wiki/Fedora_37_Mass_Rebuild

* Fri Jun 17 2022 Jens Petersen <petersen@redhat.com> - 0.1.4.1-4
- rebuild

* Thu Jan 20 2022 Fedora Release Engineering <releng@fedoraproject.org> - 0.1.4.1-3
- Rebuilt for https://fedoraproject.org/wiki/Fedora_36_Mass_Rebuild

* Sat Jan 08 2022 Miro Hrončok <mhroncok@redhat.com> - 0.1.4.1-2
- Rebuilt for https://fedoraproject.org/wiki/Changes/LIBFFI34

* Thu Aug  5 2021 Jens Petersen <petersen@redhat.com> - 0.1.4.1-1
- update to 0.1.4.1

* Thu Aug  5 2021 Jens Petersen <petersen@redhat.com> - 0.1.3.0-4
- setup bash completion

* Thu Jul 22 2021 Fedora Release Engineering <releng@fedoraproject.org> - 0.1.3.0-3
- Rebuilt for https://fedoraproject.org/wiki/Fedora_35_Mass_Rebuild

* Tue Jan 26 2021 Fedora Release Engineering <releng@fedoraproject.org> - 0.1.3.0-2
- Rebuilt for https://fedoraproject.org/wiki/Fedora_34_Mass_Rebuild

* Thu Sep 24 22:13:31 +08 2020 Jens Petersen <petersen@redhat.com> - 0.1.3.0-1
- update to 0.1.3.0

* Thu Sep  3 2020 Jens Petersen <petersen@redhat.com> - 0.1.2.0-1
- spec file generated by cabal-rpm-2.0.6
- exclude s390x because ghc-lib-parser not available
