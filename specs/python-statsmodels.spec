%bcond_with check
%bcond_with doc

%global srcname statsmodels

Name: python-%{srcname}
Version: 0.14.6
Release: %autorelease
Summary: Statistics in Python

# Package is licensed under BSD (3 clauses)
# except the following files in Public Domain
# statsmodels/datasets/anes96/data.py
# statsmodels/datasets/co2/data.py
# statsmodels/datasets/elec_equip/data.py
# statsmodels/datasets/elnino/data.py
# statsmodels/datasets/engel/data.py
# statsmodels/datasets/grunfeld/data.py
# statsmodels/datasets/longley/data.py
# statsmodels/datasets/macrodata/data.py
# statsmodels/datasets/modechoice/data.py
# statsmodels/datasets/nile/data.py
# statsmodels/datasets/randhie/data.py
# statsmodels/datasets/stackloss/data.py
# statsmodels/datasets/strikes/data.py
# statsmodels/datasets/sunspots/data.py

# Automatically converted from old format: BSD and Public Domain - review is highly recommended.
License: LicenseRef-Callaway-BSD AND LicenseRef-Callaway-Public-Domain
URL: https://www.statsmodels.org/
Source0: %{pypi_source}

BuildRequires:  gcc
BuildRequires:  python3-devel

# Drop support for i686
# https://fedoraproject.org/wiki/Changes/EncourageI686LeafRemoval
ExcludeArch:    %{ix86}


%global _description %{expand:
statsmodels is a Python module that provides classes and functions for the
estimation of many different statistical models, as well as for conducting
statistical tests, and statistical data exploration. An extensive list of
result statistics are available for each estimator. The results are tested
against existing statistical packages to ensure that they are correct.}

%description %_description

%package -n python3-%{srcname}
Summary: %{summary}

%if %{with check}
BuildRequires: %{py3_dist pytest}
BuildRequires: %{py3_dist matplotlib}
BuildRequires: python3-matplotlib-tk
BuildRequires: %{py3_dist pandas}
BuildRequires: %{py3_dist patsy}
%endif

%description -n python3-%{srcname} %_description

%package -n python3-%{srcname}-doc
Summary: Documentation for %{srcname}, includes full API docs
BuildArch: noarch

%if %{with doc}
BuildRequires: graphviz
BuildRequires: python3-sphinx
BuildRequires: python3-numpydoc
BuildRequires: python3-ipython-sphinx
BuildRequires: python3-matplotlib
%endif

%description -n python3-%{srcname}-doc
This package contains the full API documentation for python3-%{srcname}.

%prep
%autosetup -n %{srcname}-%{version} -p1
# Regenerate Cython sources
rm $(grep -rl '/\* Generated by Cython')

pushd statsmodels
 # Copy license files
 cp -a stats/libqsturng/LICENSE.txt ../LICENSE.libqsturng.txt
popd

# Allow setuptools_scm 9, already allowed upstream in main branch
sed -i 's/setuptools_scm\[toml\]>=8,<9/setuptools_scm[toml]>=8,<10/' pyproject.toml

%generate_buildrequires
%pyproject_buildrequires

%build
%pyproject_wheel

%install
%pyproject_install

%pyproject_save_files statsmodels


%if %{with check}
%check
export PYTHONDONTWRITEBYTECODE=1
export PYTEST_ADDOPTS='-p no:cacheprovider'
pushd %{buildroot}/%{python3_sitearch}
 %pytest statsmodels
popd
%endif

%files -n python3-%{srcname} -f %{pyproject_files}
%license LICENSE.txt LICENSE.libqsturng.txt
%doc COPYRIGHTS.txt README_l1.txt README.rst

%files -n python3-%{srcname}-doc
%license LICENSE.txt LICENSE.libqsturng.txt
## %doc build/sphinx/html

%changelog
%autochangelog
