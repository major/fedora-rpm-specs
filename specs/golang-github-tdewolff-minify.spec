# Generated by go2rpm 1.17.1
%bcond check 1
%bcond bootstrap 0

%if %{with bootstrap}
%global debug_package %{nil}
%endif

%if %{with bootstrap}
%global __requires_exclude %{?__requires_exclude:%{__requires_exclude}|}^golang\\(.*\\)$
%endif

# https://github.com/tdewolff/minify
%global goipath         github.com/tdewolff/minify
Version:                2.24.0

%gometa -L -f

%global goaltipaths     github.com/tdewolff/minify/v2

%global common_description %{expand:
Minify is a minifier package written in Go. It provides HTML5, CSS3, JS, JSON,
SVG and XML minifiers and an interface to implement any other minifier.
Minification is the process of removing bytes from a file (such as whitespace)
without changing its output and therefore shrinking its size and speeding up
transmission over the internet and possibly parsing. The implemented minifiers
are designed for high performance.

The core functionality associates mimetypes with minification functions,
allowing embedded resources (like CSS or JS within HTML files) to be minified as
well. Users can add new implementations that are triggered based on a mimetype
(or pattern), or redirect to an external command (like ClosureCompiler,
UglifyCSS, ...).}

%global golicenses      LICENSE
%global godocs          README.md README-minify.md

Name:           golang-github-tdewolff-minify
Release:        %autorelease
Summary:        Go minifiers for web formats

License:        MIT
URL:            %{gourl}
Source:         %{gosource}

BuildRequires:  (golang(github.com/tdewolff/parse/v2) >= 2.8.3 with golang(github.com/tdewolff/parse/v2) < 3)

%description %{common_description}

%gopkg

%prep
%goprep -A
%autopatch -q -p1
mv cmd/minify/README.md README-minify.md
sed -i \
    -e 's|\<minify\>|gominify|' \
    cmd/minify/bash_completion

%if %{without bootstrap}
%generate_buildrequires
%go_generate_buildrequires
%endif

%if %{without bootstrap}
%build
export LDFLAGS='-X main.Version=%{version} '
%gobuild -o %{gobuilddir}/bin/gominify %{goipath}/cmd/minify
%endif

%install
%gopkginstall
%if %{without bootstrap}
install -m 0755 -vd                     %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/* %{buildroot}%{_bindir}/
# shell completion
install -d %{buildroot}%{_datadir}/bash-completion/completions
install -Dpm0644 cmd/minify/bash_completion %{buildroot}%{_datadir}/bash-completion/completions/gominify
%endif

%if %{without bootstrap}
%if %{with check}
%check
%gocheck
%endif
%endif

%if %{without bootstrap}
%files
%license LICENSE
%doc README.md README-minify.md
%{_bindir}/gominify
%dir %{_datadir}/bash-completion
%dir %{_datadir}/bash-completion/completions
%{_datadir}/bash-completion/completions/gominify
%endif

%gopkgfiles

%changelog
%autochangelog
