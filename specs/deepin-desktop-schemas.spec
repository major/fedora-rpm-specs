# Generated by go2rpm 1.18.0
%bcond check 1
%global debug_package %{nil}

# https://github.com/linuxdeepin/deepin-desktop-schemas
%global goipath         github.com/linuxdeepin/deepin-desktop-schemas
Version:                6.0.13
%global tag             6.0.13

%gometa -L


Name:           deepin-desktop-schemas
Release:        %autorelease
Summary:        GSettings deepin desktop-wide schemas

# Generated by go-vendor-tools
License:        CC-BY-4.0 AND CC0-1.0 AND GPL-3.0-only AND GPL-3.0-or-later
URL:            %{gourl}
Source0:        %{gosource}
# Generated by go-vendor-tools
Source1:        %{archivename}-vendor.tar.bz2
Source2:        go-vendor-tools.toml

BuildRequires:  go-vendor-tools

%if %{with check}
# For glib-compile-schemas
BuildRequires:  glib2
%endif

Requires:       dconf
Requires:       deepin-gtk-theme
Requires:       deepin-icon-theme
Requires:       deepin-sound-theme
Obsoletes:      deepin-artwork-themes <= 15.12.4

%description
deepin-desktop-schemas contains a collection of GSettings schemas for
settings shared by various components of a desktop.

%prep
%goprep -A
%setup -q -T -D -a1 %{forgesetupargs}
%autopatch -p1

# fix default background url
sed -i "s#/usr/share/backgrounds/default_background.jpg#/usr/share/backgrounds/deepin/desktop.jpg#" \
    overrides/common/com.deepin.wrap.gnome.desktop.override \
    schemas/com.deepin.dde.appearance.gschema.xml

sed -i 's|python|python3|' Makefile tools/overrides.py
# connectivity check uri copy from /usr/lib/NetworkManager/conf.d/20-connectivity-fedora.conf
sed -i "s#'http://detect.uniontech.com', 'http://detectportal.deepin.com'#'http://fedoraproject.org/static/hotspot.txt'#" \
    schemas/com.deepin.dde.network-utils.gschema.xml
grep uniontech schemas/com.deepin.dde.network-utils.gschema.xml && exit 1 || :

%generate_buildrequires
%go_vendor_license_buildrequires -c %{S:2}

%build
%global gomodulesmode GO111MODULE=on
%make_build

%install
%go_vendor_license_install -c %{S:2}
%make_install

%check
%go_vendor_license_check -c %{S:2}
%if %{with check}
make test
%endif

%files -f %{go_vendor_license_filelist}
%license vendor/modules.txt
%doc CHANGELOG.md README.md
%{_datadir}/glib-2.0/schemas/*
%{_datadir}/deepin-appstore/
%{_datadir}/deepin-app-store/
%{_datadir}/deepin-desktop-schemas/

%changelog
%autochangelog
