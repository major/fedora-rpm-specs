# Generated by go2rpm 1.17.1
%bcond check 1

%global sheets_commit 36bdb99dcfadde210503d8c2dcf94b34ee950e1d
%global sheets_commit_short 36bdb99

# https://github.com/cheat/cheat
%global goipath         github.com/cheat/cheat
Version:                4.4.2
%global tag             4.4.2

%gometa -L -f


Name:           cheat
Release:        %autorelease
Summary:        Help for various commands and their use cases
# Generated by go-vendor-tools
License:        Apache-2.0 AND BSD-2-Clause AND BSD-3-Clause AND ISC AND MIT
URL:            %{gourl}
Source0:        %{gosource}
# Generated by go-vendor-tools
Source1:        %{archivename}-vendor.tar.bz2
Source2:        go-vendor-tools.toml
Source3:        https://github.com/cheat/cheatsheets/archive/%{sheets_commit_short}.tar.gz
Source4:        cheat-config-FEDORA.yml
BuildRequires:  go-vendor-tools
%if %{with check}
# For tests a default editor is required
BuildRequires:  nano-default-editor
%endif

Recommends:     cheat-community-cheatsheets

%description
Cheat allows you to create and view interactive cheatsheets on the command-
line. It was designed to help remind *nix system administrators of options for
commands that they use frequently, but not frequently enough to remember.

# We wont use full versioned dependency because rpmdiff then complains about
# difference between noarch subpackages on different architectures
%package bash-completion
Summary: Bash completion support for %{name}
BuildArch: noarch
Requires: %{name} = %{version}-%{release}
Requires: bash bash-completion

%description bash-completion
Files needed to support bash completion.

%package fish-completion
Summary: Fish completion support for %{name}
BuildArch: noarch
Requires: %{name} = %{version}-%{release}
Requires: fish

%description fish-completion
Files needed to support fish completion.

%package zsh-completion
Summary: Zsh completion support for %{name}
BuildArch: noarch
Requires: %{name} = %{version}-%{release}
Requires: zsh

%description zsh-completion
Files needed to support zsh completion.

%package community-cheatsheets
Summary:   Cheatsheets created by community for %{name}
URL:       https://github.com/cheat/cheatsheets
# CC0-1.0 is for cheatsheets and is allowed as package predates 2022-08-01 ban
License:   CC0-1.0
BuildArch: noarch
Requires:  %{name} = %{version}-%{release}
Supplements:  cheat

%description community-cheatsheets
Cheatsheets for various programs created and maintained by the
community.

%prep
%goprep -A
%setup -q -T -D -a1 %{forgesetupargs}
%autopatch -p1

# extract cheatsheets and remove license file as it's detected by
# Go Vendor Tools and is not required for the main package, only for
# community-cheatsheets subpackage
%setup -q -T -D -a1 -a3 %{forgesetupargs}

%generate_buildrequires
%go_vendor_license_buildrequires -c %{S:2}

%build
%global gomodulesmode GO111MODULE=on
%gobuild -o %{gobuilddir}/bin/cheat %{goipath}/cmd/cheat

%install
%go_vendor_license_install -c %{S:2}
install -m 0755 -vd                     %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/* %{buildroot}%{_bindir}/

install -Dm 0644 -p scripts/cheat.bash %{buildroot}%{bash_completions_dir}/cheat
install -Dm 0644 -p scripts/cheat.fish %{buildroot}%{fish_completions_dir}/cheat.fish
install -Dm 0644 -p scripts/cheat.zsh  %{buildroot}%{zsh_completions_dir}/_cheat

# Install cheatsheets
mkdir -m 0755 -p %{buildroot}/%{_datadir}/cheat
mkdir -m 0755 -p %{buildroot}/%{_datadir}/cheat/vim-plugins

for sheet in `find cheatsheets-%{sheets_commit}/ -maxdepth 1 -type f`; do
  install -m 0644 -p $sheet %{buildroot}%{_datadir}/cheat/
done

for sheet in `find cheatsheets-%{sheets_commit}/vim-plugins/ -maxdepth 1 -type f`; do
  install -m 0644 -p $sheet %{buildroot}%{_datadir}/cheat/
done

mkdir -m 0755 -p %{buildroot}%{_sysconfdir}/cheat
install -m 0644 -p %{SOURCE4} %{buildroot}%{_sysconfdir}/cheat/conf.yml

%check
%go_vendor_license_check -c %{S:2}
%if %{with check}
%gotest ./...
%endif

%files -f %{go_vendor_license_filelist}
%license vendor/modules.txt
%doc doc CONTRIBUTING.md README.md
%config(noreplace) %{_sysconfdir}/cheat/conf.yml
%{_bindir}/cheat

%files community-cheatsheets
%license cheatsheets-%{sheets_commit}/.github/LICENSE.txt
%{_datadir}/cheat/

%files bash-completion
%{bash_completions_dir}/cheat

%files fish-completion
%{fish_completions_dir}/cheat.fish

%files zsh-completion
%{zsh_completions_dir}/_cheat

%changelog
%autochangelog
