# Generated by go2rpm 1.16.0.post0
%bcond check 1

# https://git.sr.ht/~xenrox/hut
%global goipath         git.sr.ht/~xenrox/hut
%global forgeurl        https://git.sr.ht/~xenrox/hut
%global version0        0.6.0
%global commit          44071643e23a543c5318fca2156b0d5271b91937

%gometa -L -f

Name:           hut
Version:        %{forgeversion}
Release:        %autorelease
Summary:        A CLI tool for Sourcehut

# Generated by go-vendor-tools
License:        AGPL-3.0-only AND Apache-2.0 AND BSD-3-Clause AND LGPL-3.0-or-later WITH LGPL-3.0-linking-exception AND MIT
URL:            %{gourl}
Source0:        %{gosource}
# Generated by go-vendor-tools
Source1:        %{archivename}-vendor.tar.bz2
Source2:        go-vendor-tools.toml

BuildRequires:  go-vendor-tools
BuildRequires:  make
BuildRequires:  scdoc

%description
hut is a CLI tool for interacting with Sourcehut instances. It supports
git.sr.ht as well as self-hosted Sourcehut instances.

%prep
%goprep -A
%setup -q -T -D -a1 %{forgesetupargs}
%autopatch -p1

%generate_buildrequires
%go_vendor_license_buildrequires -c %{S:2}

%build
%global gomodulesmode GO111MODULE=on
# The Makefile expects hut to be in the current directory
%gobuild -o hut %{goipath}
%make_build doc/hut.1 completions

%install
%go_vendor_license_install -c %{S:2}
%make_install PREFIX=%{_prefix}

%check
%go_vendor_license_check -c %{S:2}
%if %{with check}
%gotest ./...
%endif

%files -f %{go_vendor_license_filelist}
%license vendor/modules.txt
%doc README.md
%{_bindir}/hut
%{_mandir}/man1/hut.1*
%{bash_completions_dir}/hut
%{zsh_completions_dir}/_hut
%{fish_completions_dir}/hut.fish

%changelog
%autochangelog
