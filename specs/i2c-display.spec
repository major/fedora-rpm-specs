# Generated by go2rpm 1.19.0
%bcond check 1

# https://github.com/ausil/i2c-display
%global goipath         github.com/ausil/i2c-display
Version:                0.5.3

%gometa -L -f


Name:           i2c-display
Release:        %autorelease
Summary:        I2C OLED display controller for single board computers

# Generated by go-vendor-tools
License:        Apache-2.0 AND BSD-3-Clause AND MIT
URL:            %{gourl}
Source0:        %{gosource}
# Generated by go-vendor-tools
Source1:        %{archivename}-vendor.tar.bz2
Source2:        go-vendor-tools.toml

BuildRequires:  go-vendor-tools
BuildRequires:  systemd-rpm-macros
Requires:       systemd

%description
A Go application for Single Board Computers (Raspberry Pi 3/4, Rock 3C) that
controls I2C OLED displays (SSD1306, SH1106, etc.) showing system stats and
network information with rotating pages.

Features:
- System monitoring (disk, RAM, CPU temperature)
- Network interface information
- Automatic page rotation
- Systemd integration
- JSON configuration

%prep
%goprep -p1
tar -xf %{S:1}

%generate_buildrequires
%go_vendor_license_buildrequires -c %{S:2}

%build
%global gomodulesmode GO111MODULE=on
for cmd in cmd/* ; do
  %gobuild -o %{gobuilddir}/bin/$(basename $cmd) %{goipath}/$cmd
done

%install
%go_vendor_license_install -c %{S:2}
hardlink -cfv %{buildroot}/%{_licensedir}
install -m 0755 -vd                     %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/* %{buildroot}%{_bindir}/

# Install config
install -d %{buildroot}%{_sysconfdir}/i2c-display
install -m 0644 configs/config.example.json %{buildroot}%{_sysconfdir}/i2c-display/config.json

# Install example configs to docdir
install -d %{buildroot}%{_docdir}/i2c-display/configs/platforms
install -m 0644 configs/*.json %{buildroot}%{_docdir}/i2c-display/configs/
install -m 0644 configs/platforms/*.json %{buildroot}%{_docdir}/i2c-display/configs/platforms/
install -m 0644 configs/platforms/README.md %{buildroot}%{_docdir}/i2c-display/configs/platforms/

# Install systemd service
install -d %{buildroot}%{_unitdir}
install -m 0644 systemd/i2c-display.service %{buildroot}%{_unitdir}/i2c-display.service

# Install man page
install -d %{buildroot}%{_mandir}/man1
install -m 0644 man/i2c-displayd.1 %{buildroot}%{_mandir}/man1/i2c-displayd.1

%post
%systemd_post i2c-display.service

%preun
%systemd_preun i2c-display.service

%postun
%systemd_postun_with_restart i2c-display.service

%check
%go_vendor_license_check -c %{S:2}
%if %{with check}
%gotest ./...
%endif

%files -f %{go_vendor_license_filelist}
%license LICENSE
%doc BUILDING.md CONTRIBUTING.md DISPLAY_TYPES.md LICENSES.md README.md SECURITY.md
%doc %{_docdir}/i2c-display/configs/
%{_bindir}/i2c-displayd
%{_mandir}/man1/i2c-displayd.1*
%config(noreplace) %{_sysconfdir}/i2c-display/config.json
%dir %{_sysconfdir}/i2c-display/
%{_unitdir}/i2c-display.service

%changelog
%autochangelog
