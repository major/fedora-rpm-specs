Name:           perl-Log-Report-Lexicon
Version:        1.15
Release:        1%{?dist}
Summary:        Translation component of Log::Report
# t/simplecal/  "same license as libintl-perl", i.e. GPL-3.0-or-later AND LGPL-2.0-or-later
# other files:  GPL-1.0-or-later OR Artistic-1.0-Perl
License:        GPL-1.0-or-later OR Artistic-1.0-Perl
SourceLicense:  (GPL-1.0-or-later OR Artistic-1.0-Perl) AND GPL-3.0-or-later AND LGPL-2.0-or-later
URL:            https://metacpan.org/dist/Log-Report-Lexicon
Source0:        http://www.cpan.org/authors/id/M/MA/MARKOV/Log-Report-Lexicon-%{version}.tar.gz
BuildArch:      noarch
BuildRequires:  coreutils
BuildRequires:  make
BuildRequires:  perl-generators
BuildRequires:  perl-interpreter
BuildRequires:  perl(:VERSION) >= 5.16
BuildRequires:  perl(Config)
BuildRequires:  perl(ExtUtils::MakeMaker) >= 6.76
# Run-time:
BuildRequires:  perl(base)
BuildRequires:  perl(constant)
BuildRequires:  perl(Encode)
BuildRequires:  perl(Fcntl)
BuildRequires:  perl(File::Find)
BuildRequires:  perl(File::Spec)
# Getopt::Long not used at tests
BuildRequires:  perl(List::Util)
BuildRequires:  perl(Locale::gettext)
BuildRequires:  perl(Log::Report) >= 1.4
BuildRequires:  perl(Log::Report::Translator)
BuildRequires:  perl(Log::Report::Util)
# Pod::Usage not used at tests
BuildRequires:  perl(POSIX)
BuildRequires:  perl(PPI)
BuildRequires:  perl(Scalar::Util)
BuildRequires:  perl(strict)
BuildRequires:  perl(warnings)
# Tests:
BuildRequires:  perl(Cwd)
BuildRequires:  perl(Data::Dumper)
BuildRequires:  perl(File::Basename)
BuildRequires:  perl(File::Spec::Functions)
BuildRequires:  perl(File::Temp)
BuildRequires:  perl(lib)
BuildRequires:  perl(locale)
BuildRequires:  perl(Test::More) >= 1.00
BuildRequires:  perl(utf8)
# Optional tests
BuildRequires:  glibc-langpack-tr
Requires:       perl(Log::Report) >= 1.4

# Remove under-specified dependencies
%global __requires_exclude %{?__requires_exclude:%{__requires_exclude}|}^perl\\((Log::Report|Test::More)\\)$

%description
This package contains all components of Log::Report which handle translations.

%package tests
Summary:        Tests for %{name}
License:        (GPL-1.0-or-later OR Artistic-1.0-Perl) AND GPL-3.0-or-later AND LGPL-2.0-or-later
Requires:       %{name} = %{?epoch:%{epoch}:}%{version}-%{release}
Requires:       perl-Test-Harness
Requires:       perl(Log::Report) >= 1.4
Requires:       perl(Test::More) >= 1.00
# Optional tests
Requires:       glibc-langpack-tr

%description tests
Tests from %{name}. Execute them
with "%{_libexecdir}/%{name}/test".

%prep
%setup -q -n Log-Report-Lexicon-%{version}
# Remove Win32 specific files which do not work on Linux
rm lib/Log/Report/Win32Locale.*
perl -i -ne 'print $_ if m{^lib/Log/Report/Win32Locale.}' MANIFEST
# Correct shebangs
for F in t/*.t; do
    perl -i -MConfig -ple 'print $Config{startperl} if $. == 1 && !s{\A#!\s*perl}{$Config{startperl}}' "$F"
    chmod +x "$F"
done


%build
perl Makefile.PL INSTALLDIRS=vendor NO_PACKLIST=1 NO_PERLLOCAL=1
%{make_build}

%install
%{make_install}
%{_fixperms} %{buildroot}/*
# Install tests
mkdir -p %{buildroot}%{_libexecdir}/%{name}
cp -a t %{buildroot}%{_libexecdir}/%{name}
cat > %{buildroot}%{_libexecdir}/%{name}/test << 'EOF'
#!/bin/sh
cd %{_libexecdir}/%{name} && exec prove -I . -j "$(getconf _NPROCESSORS_ONLN)"
EOF
chmod +x %{buildroot}%{_libexecdir}/%{name}/test

%check
export HARNESS_OPTIONS=j$(perl -e 'if ($ARGV[0] =~ /.*-j([0-9][0-9]*).*/) {print $1} else {print 1}' --
 '%{?_smp_mflags}')
make test

%files
# README.txt contains more pointers than README.
%doc ChangeLog README.txt
%{_bindir}/xgettext-perl
%dir %{perl_vendorlib}/Log
%dir %{perl_vendorlib}/Log/Report
%{perl_vendorlib}/Log/Report/Extract
%{perl_vendorlib}/Log/Report/Extract.pm
%{perl_vendorlib}/Log/Report/Extract.pod
%{perl_vendorlib}/Log/Report/Lexicon
%{perl_vendorlib}/Log/Report/Lexicon.pm
%{perl_vendorlib}/Log/Report/Lexicon.pod
%{perl_vendorlib}/Log/Report/Translator
%dir %{perl_vendorlib}/Log/Report/messages
%{perl_vendorlib}/Log/Report/messages/log-report-lexicon
%{_mandir}/man1/xgettext-perl.*
%{_mandir}/man3/Log::Report::Extract.*
%{_mandir}/man3/Log::Report::Extract::*
%{_mandir}/man3/Log::Report::Lexicon.*
%{_mandir}/man3/Log::Report::Lexicon::*
%{_mandir}/man3/Log::Report::Translator::*

%files tests
%{_libexecdir}/%{name}

%changelog
* Fri Dec 05 2025 Petr Pisar <ppisar@redhat.com> - 1.15-1
- 1.15 bump

* Wed Nov 05 2025 Petr Pisar <ppisar@redhat.com> 1.14-1
- Specfile autogenerated by cpanspec 1.78.
